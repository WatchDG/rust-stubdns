services:
  stubdns:
    build:
      context: .
      dockerfile: Dockerfile
    ports:
      - "8053:8053/tcp"
      - "8053:8053/udp"
    restart: unless-stopped

  dns-client:
    image: alpine:latest
    command: sh -c "apk add --no-cache bind-tools && while true; do nslookup -port=8053 example.com stubdns; sleep 10; done"
    depends_on:
      - stubdns
    restart: unless-stopped
